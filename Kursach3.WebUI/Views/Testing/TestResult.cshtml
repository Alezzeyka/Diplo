@using Kursach3.WebUI.Models
@using Kursach3Domain.Entities
@using Kursach3.WebUI.HtmlHelpers
@using Kursach3.WebUI.Models
@{
    @model TestResultViewModel
    Layout = "~/Views/Shared/_TestingLayout.cshtml";
    int i = 1;
}
@Html.Hidden("Id", Model.Test.Id)
<h1>Результаты</h1>
<h2>Ваш результат состовляет @Model.score из @Model.Test.MaxScore</h2>
<h1>Вопросы</h1>
<ul class="nav nav-tabs">
    @foreach (var p in Model.Questions)
    {
        string s = "#nav-quest" + p.Id.ToString();
        if (i == 1)
        {
            <li class="nav-item">
                <a class="navbar-link active" data-toggle="tab" href=@s>@i</a>
            </li>

        }
        else
        {
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href=@s>@i</a>
            </li>

        }
        i = i + 1;
    }
</ul>
    @{ i = 1; }
<div class="tab-content">
    @foreach (var p in Model.ResultStrings)
     {        
        string s = "nav-quest" + p.QuestionId.ToString();
        Question question = Model.Questions.First(x => x.Id == p.QuestionId);
        if (p.IsCorrect == true)
        {
         <div class="tab-pane fade" id=@s>
             <div class="jumbotron alert-success">
                 <p class="lead"><strong>@question.QuestionForm</strong></p>
                 @if (question.ImgId != 0)
                 {
                     Picture picture = Model.Pictures.First(x => x.Id == question.ImgId);
                     <div class="img-thumbnail">@Html.Raw("<img style='width:150px; height:250px;'vspace='5' hspace='5' src=\"data:image/jpeg;base64," + Convert.ToBase64String(picture.Image) + "\"/>")</div>
                 }
                 @foreach (var a in Model.Answers.Where(x => x.QuestionID == question.Id))
                 {
                     string name = "answer" + i;
                     if (a.Id == p.AnswerId)
                     {
             <div class="alert-success">
                 <input name="@name" type="radio" checked disabled>
                 <span class="text-success">@a.AnswerForm</span> <br />
             </div>
                     }
                     else
                     {
                         <input name="@name" type="radio" disabled>
                         <span>@a.AnswerForm</span> <br />
                     }
                 }
             </div>
         </div>
         }
         else
         {
        <div class="tab-pane fade" id=@s>
        <div class="jumbotron alert-danger">
        <p class="lead"><strong>@question.QuestionForm</strong></p>
        @if (question.ImgId != 0)
        {
        Picture picture = Model.Pictures.First(x => x.Id == question.ImgId);
        <div class="img-thumbnail">@Html.Raw("<img style='width:150px; height:250px;'vspace='5' hspace='5' src=\"data:image/jpeg;base64," + Convert.ToBase64String(picture.Image) + "\"/>")</div>
        }
        @foreach (var a in Model.Answers.Where(x => x.QuestionID == question.Id))
        {
            string name = "answer" + i;
            if (a.Id == p.AnswerId)
            {
                <div class="alert-danger">
                <input name="@name" type="radio" checked disabled>
                <span class="text-danger">@a.AnswerForm</span> <br />
                </div>
            }
            else
            {
                if (a.IsCorrect == true)
                {
                    <div class="alert-success">
                    <input name="@name" type="radio" disabled>
                    <span class="text-success">@a.AnswerForm</span> <br />
                    </div>
                }
                else
                {
                    <input name="@name" type="radio" disabled>
                    <span>@a.AnswerForm</span> <br />
                }
            }
         }
        </div>
        </div>
           }
        i = i + 1;
     }
</div>
<div class="panel panel-footer text-center" style="margin-bottom:10%;">
    <div>
        @using (Html.BeginForm("Testing", "Testing"))
        {
            @Html.Hidden("TestID", Model.Test.Id)
            <input class="btn btn-block btn-success btn-lg" type="submit" value="Пройти еще раз" />
        }
        @Html.ActionLink("Главная", "List", "Test", null, new { @class = "btn btn-block btn-default btn-lg" })
    </div>
</div>